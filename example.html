<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GravitApi test</title>
    <script src="api.js"></script>
</head>
<body>
    <h1>GravitApi test</h1>
    <textarea id="log" style="width: 100%; height: 200px;"></textarea>
    <script>
        let log = document.getElementById('log');
        const api = new GravitApi();
        api.onOpen = () => {
            api.sendRequest('getAvailabilityAuth', {}, (auth) => {
                log.append('Соединение установлено\n');
                log.append(JSON.stringify(auth)+'\n');
                auth = auth.list.pop();
                log.append(`Select auth: ${auth.name}\n`);
                api.sendRequest('auth', {
                        login: "test",
                        password: {
                            password: "test",
                            type: "plain"
                        },
                        auth_id: auth.name,
                        getSession: false,
                        authType: "API",
                        initProxy: false
                    }, (res) => {
                        console.log(res);
                        log.append(JSON.stringify(res)+'\n');
                        api.close();
                    }, (error) => {
                        log.append(error);
                    });
            }, (error) => {
                log.append(error);
            });
        }
        api.onClose = (e) => {
            if (e.wasClean) return log.append('Соединение закрыто\n');
            if (e.code === 1006) log.append('Разрыв соединения\n');
        }
        api.onError = () => {
            log.append('Ошибка при подключеннии!\n');
        }
        api.connect('ws://localhost:9274/api');
    </script>
</body>
</html>